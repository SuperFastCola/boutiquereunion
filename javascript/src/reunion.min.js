!function(win){win.console||(console={log:function(){}}),"undefined"==typeof win.matchMedia&&(this.matchMedia=function(myvar){return!1});var internal={};win.dld=internal;var app=angular.module("reunion",["ngSanitize","ngRoute"]);app.controller("nosMarques",function($scope,$compile,$rootScope,$http,$route,$routeParams,$location,$filter){$scope.marques=null,$scope.photos=null,$scope.coordonnees=null,$scope.types=null,$scope.currentSlide=null,$scope.selectedType="",$scope.scrollTop=0,$scope.currentDate=new Date,$scope.cacheBuster=0,$scope.setBackgroundThumbnailImage=function(obj){0===$scope.cacheBuster&&($scope.currentDate=new Date,$scope.cacheBuster=$scope.currentDate.getTime());var images_sub_directory="images/full/";return"undefined"!=typeof window.matchMedia&&(images_sub_directory="images/"+(window.matchMedia("(min-width: 320px)").matches&&window.matchMedia("(max-width: 480px)").matches?"mobile":"full")+"/"),obj.source+="?="+$scope.cacheBuster,"undefined"==typeof obj.detail&&(images_sub_directory+="thumbs/"),"undefined"!=typeof obj.returnURL?String(images_sub_directory+obj.source):{backgroundImage:"url("+String(images_sub_directory+obj.source)+")"}},$scope.marquesLogos=function(file){return"undefined"!=typeof file?"url("+String(file)+")":void 0},$scope.marqueHasClass=function(obj){var styles=new Object;return"undefined"!=typeof obj["class"]?styles[obj["class"]]=!0:styles=!1,styles},$scope.marqueHasLogo=function(file){return"undefined"!=typeof file?!0:!1},$scope.changeMarques=function(val){$scope.selectedType=$scope.setType(val),$scope.selectedTypeIndex=val},$scope.navItemClicked=function(val){return $scope.selectedTypeIndex==val?!0:!1},$scope.setType=function(index){return $scope.cacheBuster=0,$scope.marques[$scope.types[index]]},$scope.parseResponse=function(response){$scope.marques=response.marques,$scope.photos=response.photos,$scope.coordonnees=response.coordonnees,$scope.types=new Array;for(k in $scope.marques)$scope.types.push(k);$scope.selectedType=$scope.setType(0),$scope.selectedTypeIndex=0},$scope.loadSlideShow=function(scope){for(var i in $scope.photos);},$scope.handleSlideCounter=function(slide,increase){var amt=slide,photoArraySize=$scope.photos.length;return increase?amt++:amt--,amt>photoArraySize-1&&(amt=0),0>amt&&(amt=photoArraySize-1),amt},$scope.changeSlide=function(forward){forward?$scope.currentSlide=$scope.handleSlideCounter($scope.currentSlide,!0):$scope.currentSlide=$scope.handleSlideCounter($scope.currentSlide,!1)},$scope.getFilter=function(){return{type:$scope.selectedType||void 0||"!illustration"||"!about"}},$scope.$watch("scrollTop",function(newVal,oldVal){newVal!=oldVal&&$scope.$broadcast("scrollTop",{scrollTop:newVal})}),$scope.$watch("mobile",function(newVal,oldVal){newVal!=oldVal&&$scope.$broadcast("windowResize",{newWidth:newVal})}),$scope.checkMobile=function(){$scope.mobile=window.matchMedia("(min-width: 320px)").matches&&window.matchMedia("(max-width: 480px)").matches?"mobile":"full"},$scope.mobile="full",$http.get("/projects.json").success($scope.parseResponse),$scope.hiddenPhoto=function(index){return index!=$scope.currentSlide?"100%":"0%"},$scope.loadBackground=function(scope){if(scope.imageLoading){scope.imageLoading=!1;var filename="undefined"!=typeof scope.x?scope.x.filename:scope.filename;scope.backgroundImage=scope.setBackgroundThumbnailImage({source:filename,detail:!0,returnURL:!0}),$http({method:"GET",responseType:"arraybuffer",url:scope.backgroundImage}).then(function(response){scope.imageLoaded=!0;var blob=new Blob([response.data],{type:"image/jpeg"});scope.backgroundStyle="url("+(window.URL||window.webkitURL).createObjectURL(blob)+")"},function(response){console.log(response)})}}}),app.directive("autoresize",function($window){return function($scope){return $scope.initializeWindowSize=function(){return $scope.maxHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight,window.innerHeight),$scope.scrollTop=$window.pageYOffset,$scope.windowHeight=$window.innerHeight,$scope.viewBottom=$scope.windowHeight,$scope.windowWidth=$window.innerWidth},$scope.initializeWindowSize(),angular.element($window).bind("resize",function(){return $scope.initializeWindowSize(),$scope.cacheBuster=0,$scope.$broadcast("scrollTop",{scrollTop:$scope.scrollTop}),$scope.checkMobile(),$scope.$apply()})}}),app.directive("loadInitialImage",function($http){return{link:function(scope,element,attrs){"undefined"!=typeof scope.x.initial&&(scope.$parent.currentSlide=scope.$index),scope.$parent.loadBackground(scope)}}}),app.directive("scrollposition",function($window){return function($scope){return $scope.scrollTop=$window.pageYOffset,$scope.viewBottom=$window.pageYOffset+$window.innerHeight,angular.element($window).bind("scroll",function(){return $scope.scrollTop=$window.pageYOffset,$scope.viewBottom=$window.pageYOffset+$window.innerHeight,$scope.$apply()})}}),app.directive("checkObjectPosition",function($window,$http){return{link:function(scope,element,attrs){element[0].getBoundingClientRect().top<$window.pageYOffset+$window.innerHeight&&scope.loadBackground(scope),scope.$on("windowResize",function(event,args){if("undefined"!=typeof scope.backgroundStyle){String(scope.backgroundStyle.backgroundImage).match(scope.$parent.mobile)}}),scope.$on("scrollTop",function(event,args){element[0].getBoundingClientRect().top<window.innerHeight&&"undefined"==typeof scope.backgroundStyle&&scope.loadBackground(scope)})}}})}(window);