!function(win){win.console||(console={log:function(){}}),void 0===win.matchMedia&&(this.matchMedia=function(myvar){return!1});win.dld={};var app=angular.module("reunion",["ngSanitize","ngRoute"]);app.controller("nosMarques",function($scope,$compile,$rootScope,$http,$route,$routeParams,$location,$filter){$scope.marques=null,$scope.photos=null,$scope.coordonnees=null,$scope.types=null,$scope.currentSlide=null,$scope.instagram=new Array,$scope.selectedType="",$scope.scrollTop=0,$scope.navHeight=0,$scope.nouvelles=new Array,$scope.showNews=!1,$scope.minimizeNewsArea=!1,$scope.navHeightStyle="auto",$scope.smallscreen=!(!window.matchMedia("(min-width: 320px)").matches||!window.matchMedia("(max-width: 480px)").matches),$scope.currentDate=new Date,$scope.cacheBuster=0,$scope.setBackgroundThumbnailImage=function(obj){0===$scope.cacheBuster&&($scope.currentDate=new Date,$scope.cacheBuster=$scope.currentDate.getTime());var images_sub_directory="images/full/";return void 0!==window.matchMedia&&(images_sub_directory="images/"+(window.matchMedia("(min-width: 320px)").matches&&window.matchMedia("(max-width: 480px)").matches?"mobile":"full")+"/"),obj.source+="?="+$scope.cacheBuster,void 0===obj.detail&&(images_sub_directory+="thumbs/"),void 0!==obj.returnURL?String(images_sub_directory+obj.source):{backgroundImage:"url("+String(images_sub_directory+obj.source)+")"}},$scope.marquesLogos=function(file){return void 0!==file?"url("+String(file)+")":void 0},$scope.marqueHasClass=function(obj){var styles=new Object;return void 0!==obj.class?styles[obj.class]=!0:styles=!1,styles},$scope.marqueHasLogo=function(file){return void 0!==file},$scope.setNavHeight=function(){var nav=document.querySelector(".contenu-marques");$scope.navHeightStyle="auto",setTimeout(function(){var newheight=nav.offsetHeight;isNaN(newheight)||0==newheight||($scope.navHeightStyle=String(newheight)+"px")},500)},$scope.changeMarques=function(val){$scope.selectedType=$scope.setType(val),$scope.selectedTypeIndex=val},$scope.navItemClicked=function(val){return $scope.selectedTypeIndex==val},$scope.setType=function(index){return $scope.cacheBuster=0,$scope.marques[$scope.types[index]]},$scope.parseResponse=function(response){for(k in $scope.marques=response.marques,$scope.photos=response.photos,$scope.coordonnees=response.coordonnees,$scope.types=new Array,$scope.marques)$scope.types.push($scope.marques[k]);$scope.selectedType=$scope.types,$http.get("/nouvelles_v2.json?="+(new Date).getTime()).success($scope.displayNouvelles)},$scope.minimizeNews=function(){$scope.minimizeNewsArea=!$scope.minimizeNewsArea},$scope.displayNouvelles=function(response){var newsObject={message:response.data[0].message,link:response.data[0].permalink_url,picture:response.data[0].attachments.data[0].subattachments.data[0].media.image.src};"object"!=typeof response&&10<String(response).length?($scope.nouvelles.push(newsObject),$scope.showNews=!0):"object"==typeof response&&($scope.nouvelles.push(newsObject),$scope.showNews=!0),$scope.displayInstagram(response)},$scope.showInstagramDescription=function(){this.show=!this.show},$scope.displayInstagram=function(data){for(var i in data.data)if(console.log(data.data[i].attachments.data[0].subattachments),void 0!==data.data[i].attachments.data[0].subattachments&&$scope.instagram.push({caption:data.data[i].message,image:data.data[i].attachments.data[0].subattachments.data[0].media.image.src,link:data.data[i].permalink_url}),12==i)break},$scope.renderBackground=function(image){return"url("+image+")"},$scope.loadSlideShow=function(scope){for(var i in $scope.photos);},$scope.handleSlideCounter=function(slide,increase){var amt=slide,photoArraySize=$scope.photos.length;return increase?amt++:amt--,photoArraySize-1<amt&&(amt=0),amt<0&&(amt=photoArraySize-1),amt},$scope.changeSlide=function(forward){$scope.currentSlide=forward?$scope.handleSlideCounter($scope.currentSlide,!0):$scope.handleSlideCounter($scope.currentSlide,!1)},$scope.getFilter=function(){return{type:$scope.selectedType||"!illustration"}},$scope.$watch("scrollTop",function(newVal,oldVal){newVal!=oldVal&&$scope.$broadcast("scrollTop",{scrollTop:newVal})}),$scope.$watch("mobile",function(newVal,oldVal){newVal!=oldVal&&$scope.$broadcast("windowResize",{newWidth:newVal})}),$scope.checkMobile=function(){$scope.mobile=window.matchMedia("(min-width: 320px)").matches&&window.matchMedia("(max-width: 480px)").matches?"mobile":"full"},$scope.mobile="full",$http.get("/projects.json").success($scope.parseResponse),$scope.hiddenPhoto=function(index){return index!=$scope.currentSlide?"100%":"0%"},$scope.loadBackground=function(scope){if(scope.imageLoading){scope.imageLoading=!1;var filename=void 0!==scope.x?scope.x.filename:scope.filename;scope.backgroundImage=scope.setBackgroundThumbnailImage({source:filename,detail:!0,returnURL:!0}),$http({method:"GET",responseType:"arraybuffer",url:scope.backgroundImage}).then(function(response){scope.imageLoaded=!0;var blob=new Blob([response.data],{type:"image/jpeg"});scope.backgroundStyle="url("+(window.URL||window.webkitURL).createObjectURL(blob)+")"},function(response){console.log(response)})}}}),app.directive("autoresize",function($window){return function($scope){return $scope.initializeWindowSize=function(){return $scope.maxHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight,window.innerHeight),$scope.scrollTop=$window.pageYOffset,$scope.windowHeight=$window.innerHeight,$scope.viewBottom=$scope.windowHeight,$scope.windowWidth=$window.innerWidth},$scope.initializeWindowSize(),angular.element($window).bind("resize",function(){return $scope.initializeWindowSize(),$scope.cacheBuster=0,$scope.$broadcast("scrollTop",{scrollTop:$scope.scrollTop}),$scope.checkMobile(),$scope.$apply()})}}),app.directive("loadInitialImage",function($http){return{link:function(scope,element,attrs){void 0!==scope.x.initial&&(scope.$parent.currentSlide=scope.$index),scope.$parent.loadBackground(scope)}}}),app.directive("autoresize",function($window){return function($scope){return $scope.initializeWindowSize=function(){return $scope.maxHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight,window.innerHeight),$scope.scrollTop=$window.pageYOffset,$scope.windowHeight=$window.innerHeight,$scope.viewBottom=$scope.windowHeight,$scope.windowWidth=$window.innerWidth},$scope.initializeWindowSize(),angular.element($window).bind("resize",function(){return $scope.initializeWindowSize(),$scope.cacheBuster=0,$scope.$broadcast("scrollTop",{scrollTop:$scope.scrollTop}),$scope.checkMobile(),$scope.$apply()})}}),app.directive("scrollposition",function($window){return function($scope){return $scope.scrollTop=$window.pageYOffset,$scope.viewBottom=$window.pageYOffset+$window.innerHeight,angular.element($window).bind("scroll",function(){return $scope.scrollTop=$window.pageYOffset,$scope.viewBottom=$window.pageYOffset+$window.innerHeight,$scope.$apply()})}}),app.directive("checkObjectPosition",function($window,$http){return{link:function(scope,element,attrs){element[0].getBoundingClientRect().top<$window.pageYOffset+$window.innerHeight&&scope.loadBackground(scope),scope.$on("windowResize",function(event,args){if(void 0!==scope.backgroundStyle)String(scope.backgroundStyle.backgroundImage).match(scope.$parent.mobile)}),scope.$on("scrollTop",function(event,args){element[0].getBoundingClientRect().top<window.innerHeight&&void 0===scope.backgroundStyle&&scope.loadBackground(scope)})}}})}(window);